<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <record id="account_return_check_kanban_view" model="ir.ui.view">
            <field name="name">account.return.check.kanban</field>
            <field name="model">account.return.check</field>
            <field name="arch" type="xml">
                <kanban js_class="account_return_check_kanban" create="0" edit="0" class="account_return_check_kanban">
                    <field name="state"/>
                    <field name="return_state"/>
                    <field name="result"/>
                    <field name="action"/>
                    <field name="type"/>
                    <field name="attachment_ids"/>
                    <field name="cycle"/>
                    <field name="return_id"/> <!-- mandatory -->

                    <templates>
                        <t t-name="card" class="o_return_check_kanban_card" >
                            <t t-set="result" t-value="record.result.raw_value"/>
                            <t t-set="is_return_active" t-value="record.is_return_active.raw_value" />
                            <t t-if="result === 'anomaly'">
                                <t t-set="color" t-value="'red'"/>
                            </t>
                             <t t-elif="result === 'todo'">
                                <t t-set="color" t-value="'gray'"/>
                            </t>
                            <t t-else="">
                                <t t-set="color" t-value="'green'"/>
                            </t>
                            <t t-set="message" t-value="record.message.raw_value"/>
                            <t t-set="records_count" t-value="record.records_count.raw_value"/>
                            <t t-set="records_name" t-value="record.records_name.raw_value"/>
                            <t t-set="return_state" t-value="record.return_state.raw_value"/>

                            <div t-attf-class="return-check-card-#{color} flex-grow-1 d-flex">
                                <div class="w-100 h-100 py-2 ps-4 pe-1 row align-items-center align-self-center">
                                    <div class="col-12 col-md-8">
                                        <div>
                                            <field class="oe_inline" name="name" readonly="1" nolabel="1"/>
                                            <t t-if="records_count">
                                                <span class="text-danger small">
                                                    <field name="records_count" class="ms-1" invisible="not records_count or records_count &gt;= 21"/>
                                                    <span invisible="not records_count or records_count &lt; 21">20+</span>
                                                    <span invisible="not records_count"> </span>
                                                    <field name="records_name"/>
                                                </span>
                                            </t>
                                        </div>
                                        <div invisible="not message" class="row text-muted">
                                            <field name="message" widget="text" class="mt-2"/>
                                        </div>
                                        <div class="d-flex align-items-center mt-2">
                                            <widget invisible="type != 'file' or attachment_ids or not is_return_active" name="account_return_check_file_uploader"/>
                                            <widget invisible="type != 'file' or not attachment_ids or not is_return_active" name="account_return_check_attachment_viewer"/>
                                            <button invisible="type != 'file' or not attachment_ids or not is_return_active" type="object" class="btn-link fa-lg text-dark ms-1" title="delete" icon="fa-trash" name="action_unlink_attachments"/>
                                        </div>
                                    </div>
                                    <div class="col-12 col-md-4 h-full d-flex justify-content-end align-items-center my-auto">
                                        <field name="approver_supervisor_ids" widget="kanban.many2many_avatar_user_approver" readonly="True" class="mt-1 me-2"/>
                                        <t t-if="return_state == 'new'">
                                            <field
                                                name="result"
                                                widget="account_return_selection_badge"
                                                options="{
                                                    'todo': {'decoration': 'info'},
                                                    'reviewed': {'decoration': 'success'},
                                                    'supervised': {'decoration': 'success', 'can_edit': 'account.group_account_manager'},
                                                    'anomaly': {'decoration': 'danger'},
                                                }"
                                            />
                                        </t>
                                        <t t-else="">
                                            <field
                                                name="result"
                                                widget="account_return_selection_badge"
                                                options="{
                                                    'todo': {'decoration': 'info', 'can_edit': false},
                                                    'reviewed': {'decoration': 'success', 'can_edit': false},
                                                    'supervised': {'decoration': 'success', 'can_edit': false},
                                                    'anomaly': {'decoration': 'danger', 'can_edit': false},
                                                }"
                                            />
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="account_return_check_search_view" model="ir.ui.view">
            <field name="name">account.return.check.search</field>
            <field name="model">account.return.check</field>
            <field name="arch" type="xml">
                <search>
                    <field name="name"/>
                    <field name="result"/>
                    <field name="cycle"/>
                    <field name="type"/>
                    <field name="return_id"/>
                    <field name="template_id"/>

                    <filter name="anomaly_checks" string="Anomaly" domain="[('result', '=', 'anomaly')]"/>
                    <filter name="todo_checks" string="To Review" domain="[('result', '=', 'todo')]"/>
                    <filter name="reviewed_checks" string="Reviewed" domain="[('result', '=', 'reviewed')]"/>
                    <filter name="supervised_checks" string="Supervised" domain="[('result', '=', 'supervised')]"/>
                    <filter name="groupby_cycle" string="Cycle" context="{'group_by': 'cycle'}"/>
                </search>
            </field>
        </record>
    </data>
</odoo>
