<?xml version="1.0"?>
<odoo>
    <record model="ir.ui.view" id="l10n_mx_hr_payslip_view_form">
        <field name="name">hr.payslip.inherit.form</field>
        <field name="model">hr.payslip</field>
        <field name="inherit_id" ref="hr_payroll_account.hr_payslip_view_form"/>
        <field name="arch" type="xml">
            <button name="action_print_payslip" position="attributes">
                <attribute name="invisible" add="country_code == 'MX'" separator="or"/>
            </button>
            <button name="action_payslip_done" position="attributes">
                <attribute name="invisible" add="country_code == 'MX'" separator="or"/>
            </button>
            <button name="action_payslip_done" position="before">
                <button string="Create Draft Entry" name="action_payslip_done" type="object" class="oe_highlight"
                        invisible="state != 'draft' or not line_ids or country_code != 'MX'"
                        confirm="Are you sure you want to proceed?"/>
                <button string="Generate CFDI" name="action_generate_cfdi" type="object" class="oe_highlight"
                        invisible="country_code != 'MX' or state != 'paid' or move_state != 'posted' or l10n_mx_edi_cfdi_uuid"/>
                <button string="Print CFDI" name="action_print_cfdi" type="object"
                        invisible="country_code != 'MX' or state != 'paid' or move_state != 'posted' or not l10n_mx_edi_cfdi_uuid"/>
            </button>
            <group name="top" position="inside">
                <group name="top_right">
                    <field name="l10n_mx_edi_cfdi_state"
                           invisible="not l10n_mx_edi_cfdi_state"/>
                    <field name="l10n_mx_edi_cfdi_sat_state"
                           invisible="not l10n_mx_edi_cfdi_sat_state"/>
                    <field name="l10n_mx_edi_cfdi_uuid"
                           invisible="not l10n_mx_edi_cfdi_uuid"/>
                    <field name="l10n_mx_edi_cfdi_origin"
                           readonly="l10n_mx_edi_cfdi_state in ('sent', 'cancel')"/>
                    <field name="l10n_mx_edi_cfdi_cancel_id"
                           invisible="not l10n_mx_edi_cfdi_cancel_id"/>
                </group>
            </group>
            <notebook position="inside">
                <page id="edi_documents"
                      string="CFDI"
                      name="page_cfdi"
                      invisible="not l10n_mx_edi_document_ids">
                    <field name="l10n_mx_edi_document_ids">
                        <list create="false" delete="false" edit="false" no_open="1">
                            <field name="datetime"/>
                            <field name="payslip_id"/>
                            <field name="state" widget="account_document_state"/>
                            <field name="sat_state" invisible="not sat_state"/>
                            <field name="attachment_uuid" optional="hide"/>
                            <field name="attachment_origin" optional="hide"/>
                            <field name="cancellation_reason" optional="hide"/>

                            <button name="action_show_document"
                                    type="object"
                                    string="Show"
                                    invisible="not show_button_needed or payslip_id == parent.id"/>
                            <button name="action_download_file"
                                    type="object"
                                    string="Download"
                                    invisible="not attachment_id"/>
                            <button name="action_download_payment_receipt"
                                    type="object"
                                    string="Print"
                                    invisible="not print_button_needed"/>
                            <button name="action_retry"
                                    type="object"
                                    string="Retry"
                                    invisible="not retry_button_needed"/>
                            <button name="action_force_payment_cfdi"
                                    type="object"
                                    string="Force CFDI"
                                    invisible="state != 'payment_sent_pue'"/>
                            <button name="action_cancel"
                                    type="object"
                                    string="Cancel"
                                    invisible="not cancel_button_needed"/>
                        </list>
                    </field>
                </page>
            </notebook>
        </field>
    </record>
</odoo>
